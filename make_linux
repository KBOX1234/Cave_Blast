# Compiler and general settings
CC = c++
INCLUDE = -I./include -I./external/rl_imgui/ -I./external/raylib/src/ -I./external/imgui/ -I./external/enet/include/ -I./external/sphysics/ -I./external/easy_profiler/easy_profiler_core/include -I./external/soloud/include/
LINKS = -L./lib
LIBS = LIBS = -lraylib -lm -ldl -lpthread -lGL -lX11 -lrlImGui -lenet -lsphysics -leasy_profiler -lsoloud -lasound -Wl,-rpath=./lib

SRC_DIR = src
OBJ_DIR = obj

# Find all .cpp files recursively
SRCS := $(shell find $(SRC_DIR) -type f -name '*.cpp')

# Turn src/foo/bar.cpp into obj/foo/bar.o
OBJS := $(patsubst $(SRC_DIR)/%.cpp,$(OBJ_DIR)/%.o,$(SRCS))

TARGET = main

# Default to debug build
all: debug

# Debug build: includes -g and no optimization
debug: CFLAGS = -g -O0 $(INCLUDE)
debug: $(TARGET)

# Release build: optimized and stripped
release: CFLAGS = -O2 -s $(INCLUDE) -DEASY_PROFILER_ENABLED=1
release: $(TARGET)
	strip $(TARGET)

$(TARGET): $(OBJS)
	$(CC) -o $@ $(OBJS) $(LINKS) $(LIBS) $(CFLAGS)

# Compile each source file to object
$(OBJ_DIR)/%.o: $(SRC_DIR)/%.cpp
	@mkdir -p $(dir $@)   # make sure subdirectory exists
	$(CC) -c $< -o $@ $(CFLAGS)

# Clean build files
clean:
	rm -rf $(OBJ_DIR) $(TARGET)
